{% extends 'facturacion/base.html' %}
{% block title %} Agregar Item {% endblock %}
{% block script %}

<script>
var marcas="";
var unidades="";
var grupos="";


  $(function() {
  	
  
    marcas = '{{marcas}}';
    marcas=marcas.replace(/\&quot;/g, '"')
    marcas=marcas.split(",");
    
    //[{ value: 'Andorra', data: 'AD' },{ value: 'Zimbabwe', data: 'ZZ' }]
    
    unidades = '{{unidades}}';
    unidades=unidades.replace(/\&quot;/g, '"')
    unidades=unidades.split(",");
    
    grupos = '{{grupos}}';
    grupos=grupos.replace(/\&quot;/g, '"')
    grupos=grupos.split(",");
    
    bodegas = '{{bodegas}}';
    bodegas=bodegas.replace(/\&quot;/g, '"')
    bodegas=bodegas.split(",");
    
    
    $( "#id_marca" ).autocomplete({
      source: marcas
    });
    
    $( "#id_unidad" ).autocomplete({
      source: unidades
    });
    
    $( "#id_grupo" ).autocomplete({
      source: grupos
    });
    
    $( "#id_bodega" ).autocomplete({
      source: bodegas
    });
    
    
    
    $("#formulario").submit(function(e){

         dataString = $("#formulario").serialize();
         $("#id_marca").val()
         mensaje = "";
         if(marcas.indexOf($("#id_marca").val())==(marcas.length-1)
         	||marcas.indexOf($("#id_marca").val())==-1)
         	mensaje=mensaje+'seleccione una Marca existente\n';
         
         if(unidades.indexOf($("#id_unidad").val())==(unidades.length-1)
         	||unidades.indexOf($("#id_unidad").val())==-1)
         	mensaje=mensaje+'seleccione una Unidad existente\n';
         
         if(grupos.indexOf($("#id_grupo").val())==(grupos.length-1)
         	||grupos.indexOf($("#id_grupo").val())==-1)
         	mensaje=mensaje+'seleccione un Grupo existente\n';
         	
         if(bodegas.indexOf($("#id_bodega").val())==-1)
         	mensaje=mensaje+'seleccione una Bodega existente\n';
         	
         if(mensaje!=""){
         		alert(mensaje);
         		return false;
         	}
	 	$.post('/item', $('#formulario').serialize())
         //return false;  //stop the actual form post !important!
 
      });
    
    
    
    
    
    
    
  });
  </script>
{% endblock script %}
{% block content %}

<br> <h2>Agregar Item</h2>

<form action="." method="POST" id="formulario">

	{% csrf_token %}
	{{ mensaje }}
	{{ form.as_p }}
	
	<input type="submit" value="Agregar">
	<input type="reset" value="Limpiar">

</form>


{% endblock %}
